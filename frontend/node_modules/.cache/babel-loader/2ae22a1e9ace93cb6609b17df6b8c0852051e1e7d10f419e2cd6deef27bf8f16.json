{"ast":null,"code":"import{API_BASE_URL}from'../config';import{useState,useEffect}from'react';import{useAuth}from'../contexts/AuthContext';import{useNavigate}from'react-router-dom';import{getCookie}from\"../utils/cookies\";import'./Profile.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Profile=()=>{const{user,updateUser,deleteUserData,logout}=useAuth();const[formData,setFormData]=useState({username:'',email:''});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const navigate=useNavigate();useEffect(()=>{if(user){setFormData({username:user.username,email:user.email});}},[user]);const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleSubmit=async e=>{e.preventDefault();if(formData.username===user.username&&formData.email===user.email){setError('No hay cambios para guardar');return;}if(!window.confirm('¿Estás seguro de que quieres actualizar tu información?')){return;}setLoading(true);setError('');try{await updateUser({username:formData.username,email:formData.email});setSuccess('Información actualizada correctamente');}catch(err){setError(err.message);setSuccess('');}finally{setLoading(false);}};const handleDelete=async()=>{if(window.confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.')){try{const response=await fetch(`${API_BASE_URL}/auth/users/${user.id}/delete/`,{method:'DELETE',headers:{\"Content-Type\":\"application/json\",'X-CSRFToken':getCookie('csrftoken')},credentials:\"include\"});if(!response.ok){throw new Error('Failed to delete account');}logout();navigate('/login');}catch(err){setError(err.message);}}};const handleDeleteData=async()=>{if(window.confirm('¿Estás seguro de que quieres borrar todos tus datos (diarios y chats)? Esta acción no se puede deshacer.')){try{await deleteUserData();window.location.reload();}catch(err){setError(err.message);}}};if(!user)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});return/*#__PURE__*/_jsx(\"div\",{className:\"profile-page-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Tu Perfil\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Usuario:\"}),\" \",user.username]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",user.email]})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"profile-form\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Actualizar Informaci\\xF3n\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",children:\"Nombre de usuario\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"username\",name:\"username\",value:formData.username,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",name:\"email\",value:formData.email,onChange:handleChange,required:true})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:success}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,children:loading?'Guardando...':'Guardar Cambios'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"danger-zone\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Zona Peligrosa\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDeleteData,className:\"delete-data-button\",children:\"Borrar Todos Mis Datos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDelete,className:\"delete-button\",children:\"Eliminar Cuenta\"})]})]})});};export default Profile;","map":{"version":3,"names":["API_BASE_URL","useState","useEffect","useAuth","useNavigate","getCookie","jsx","_jsx","jsxs","_jsxs","Profile","user","updateUser","deleteUserData","logout","formData","setFormData","username","email","loading","setLoading","error","setError","success","setSuccess","navigate","handleChange","e","target","name","value","handleSubmit","preventDefault","window","confirm","err","message","handleDelete","response","fetch","id","method","headers","credentials","ok","Error","handleDeleteData","location","reload","children","className","onSubmit","htmlFor","type","onChange","required","disabled","onClick"],"sources":["/home/ubuntu/EmberLight_Projecte2/frontend/src/pages/Profile.js"],"sourcesContent":["import { API_BASE_URL } from '../config';\nimport { useState, useEffect } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { useNavigate } from 'react-router-dom';\nimport { getCookie } from \"../utils/cookies\";\nimport './Profile.css';\n\nconst Profile = () => {\n  const { user, updateUser, deleteUserData, logout } = useAuth();\n  const [formData, setFormData] = useState({\n    username: '',\n    email: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (user) {\n      setFormData({\n        username: user.username,\n        email: user.email\n      });\n    }\n  }, [user]);\n\n  const handleChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (formData.username === user.username && formData.email === user.email) {\n      setError('No hay cambios para guardar');\n      return;\n    }\n    if (!window.confirm('¿Estás seguro de que quieres actualizar tu información?')) {\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    \n    try {\n      await updateUser({\n        username: formData.username,\n        email: formData.email\n      });\n      setSuccess('Información actualizada correctamente');\n    } catch (err) {\n      setError(err.message);\n      setSuccess('');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (window.confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.')) {\n      try {\n        const response = await fetch(`${API_BASE_URL}/auth/users/${user.id}/delete/`, {\n          method: 'DELETE',\n          headers: { \n            \"Content-Type\": \"application/json\",\n            'X-CSRFToken': getCookie('csrftoken'),\n          },\n          credentials: \"include\",\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to delete account');\n        }\n\n        logout();\n        navigate('/login');\n      } catch (err) {\n        setError(err.message);\n      }\n    }\n  };\n\n  const handleDeleteData = async () => {\n    if (window.confirm('¿Estás seguro de que quieres borrar todos tus datos (diarios y chats)? Esta acción no se puede deshacer.')) {\n      try {\n        await deleteUserData();\n        window.location.reload();\n      } catch (err) {\n        setError(err.message);\n      }\n    }\n  };\n\n  if (!user) return <div>Loading...</div>;\n\n  return (\n    <div className=\"profile-page-wrapper\">\n    <div className=\"profile-container\">\n      <div className=\"profile-header\">\n        <h2>Tu Perfil</h2>\n        <div className=\"user-info\">\n          <p><strong>Usuario:</strong> {user.username}</p>\n          <p><strong>Email:</strong> {user.email}</p>\n        </div>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"profile-form\">\n        <h3>Actualizar Información</h3>\n        \n        <div className=\"form-group\">\n          <label htmlFor=\"username\">Nombre de usuario</label>\n          <input\n            type=\"text\"\n            id=\"username\"\n            name=\"username\"\n            value={formData.username}\n            onChange={handleChange}\n            required\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"email\">Email</label>\n          <input\n            type=\"email\"\n            id=\"email\"\n            name=\"email\"\n            value={formData.email}\n            onChange={handleChange}\n            required\n          />\n        </div>\n\n        {error && <div className=\"error-message\">{error}</div>}\n        {success && <div className=\"success-message\">{success}</div>}\n\n        <button type=\"submit\" disabled={loading}>\n          {loading ? 'Guardando...' : 'Guardar Cambios'}\n        </button>\n      </form>\n\n      <div className=\"danger-zone\">\n        <h3>Zona Peligrosa</h3>\n        <button \n          onClick={handleDeleteData} \n          className=\"delete-data-button\"\n        >\n          Borrar Todos Mis Datos\n        </button>\n        <button \n          onClick={handleDelete} \n          className=\"delete-button\"\n        >\n          Eliminar Cuenta\n        </button>\n      </div>\n    </div>\n    </div>\n  );\n};\n\nexport default Profile;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}